# AI Lesson Plan Generator Implementation Checklist

## 🎯 **Overview: Feature 8 - AI-Powered Lesson Plan Generator**

**Business Value**: Saves teachers 3-5 hours weekly on lesson planning, generates standards-aligned content, creates substitute-ready versions automatically.

**Technical Approach**: OpenAI/Claude API integration + Dexterity content type + React interface + Integration with existing substitute folder system.

---

## **PHASE A: Backend Content Type & Schema** 📚 *2-3 hours*

### **A1: Create Lesson Plan Content Type**

#### **A1.1: Define Lesson Plan Schema**
**File**: `backend/src/project/title/content/lesson_plan.py` **(NEW FILE)**
```python
"""
AI-Generated Lesson Plan Content Type

Stores lesson plans generated by AI with standards alignment
and integration with classroom management features.
"""

from plone.dexterity.content import Item
from plone.supermodel import model
from plone.app.textfield import RichText
from zope import schema
from zope.interface import implementer
from datetime import datetime, date
import json
import logging

logger = logging.getLogger(__name__)


class ILessonPlan(model.Schema):
    """Schema for AI-generated lesson plans"""
    
    model.fieldset(
        'basic',
        label='Basic Information',
        fields=['title', 'description', 'subject', 'grade_level', 'duration', 'lesson_date']
    )
    
    model.fieldset(
        'content',
        label='Lesson Content',
        fields=['objectives', 'materials', 'activities', 'assessment', 'homework']
    )
    
    model.fieldset(
        'standards',
        label='Standards & Alignment',
        fields=['standards_alignment', 'vocabulary', 'differentiation']
    )
    
    model.fieldset(
        'ai_metadata',
        label='AI Generation Details',
        fields=['ai_prompt_used', 'ai_model', 'generation_date', 'is_ai_generated']
    )
    
    model.fieldset(
        'substitute',
        label='Substitute Teacher Version',
        fields=['substitute_version', 'substitute_notes', 'emergency_contact']
    )
    
    # Basic Information
    title = schema.TextLine(
        title="Lesson Title",
        description="Clear, descriptive title for the lesson",
        required=True,
    )
    
    description = schema.Text(
        title="Lesson Overview",
        description="Brief summary of what students will learn",
        required=False,
    )
    
    subject = schema.Choice(
        title="Subject",
        description="Academic subject for this lesson",
        vocabulary="project.title.vocabularies.subjects",
        required=True,
        default="Math",
    )
    
    grade_level = schema.Choice(
        title="Grade Level",
        description="Target grade level for this lesson",
        vocabulary="project.title.vocabularies.grade_levels",
        required=True,
        default="7",
    )
    
    duration = schema.Int(
        title="Duration (minutes)",
        description="How long this lesson should take",
        required=True,
        default=50,
        min=15,
        max=180,
    )
    
    lesson_date = schema.Date(
        title="Lesson Date",
        description="When this lesson will be taught",
        required=False,
        defaultFactory=lambda: date.today(),
    )
    
    # Lesson Content
    objectives = RichText(
        title="Learning Objectives",
        description="What students will be able to do after this lesson",
        required=True,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    materials = RichText(
        title="Materials Needed",
        description="List of materials and resources required",
        required=False,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    activities = RichText(
        title="Lesson Activities",
        description="Step-by-step lesson activities and procedures",
        required=True,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    assessment = RichText(
        title="Assessment Methods",
        description="How student learning will be measured",
        required=False,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    homework = RichText(
        title="Homework/Extension",
        description="Optional homework or extension activities",
        required=False,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    # Standards Alignment
    standards_alignment = schema.List(
        title="Standards Alignment",
        description="Curriculum standards this lesson addresses",
        value_type=schema.TextLine(title="Standard"),
        required=False,
        default=[],
    )
    
    vocabulary = schema.List(
        title="Key Vocabulary",
        description="Important terms students should learn",
        value_type=schema.TextLine(title="Vocabulary Term"),
        required=False,
        default=[],
    )
    
    differentiation = RichText(
        title="Differentiation Strategies",
        description="Accommodations for different learning needs",
        required=False,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    # AI Metadata
    ai_prompt_used = schema.Text(
        title="AI Prompt Used",
        description="The prompt that generated this lesson plan",
        required=False,
    )
    
    ai_model = schema.TextLine(
        title="AI Model",
        description="Which AI model generated this content",
        required=False,
        default="gpt-4",
    )
    
    generation_date = schema.Datetime(
        title="Generation Date",
        description="When this lesson was generated by AI",
        required=False,
        defaultFactory=datetime.now,
    )
    
    is_ai_generated = schema.Bool(
        title="AI Generated",
        description="Whether this lesson was created by AI",
        required=False,
        default=True,
    )
    
    # Substitute Teacher Support
    substitute_version = RichText(
        title="Substitute Teacher Version",
        description="Simplified version for substitute teachers",
        required=False,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    substitute_notes = RichText(
        title="Notes for Substitute",
        description="Special instructions for substitute teachers",
        required=False,
        default_mime_type='text/html',
        output_mime_type='text/x-html-safe',
        allowed_mime_types=['text/html', 'text/plain'],
    )
    
    emergency_contact = schema.TextLine(
        title="Emergency Contact",
        description="Who to contact if there are problems with this lesson",
        required=False,
    )


@implementer(ILessonPlan)
class LessonPlan(Item):
    """AI-generated lesson plan implementation"""
    
    def get_standards_display(self):
        """Return standards as formatted string"""
        if self.standards_alignment:
            return ", ".join(self.standards_alignment)
        return "No standards specified"
    
    def get_duration_display(self):
        """Return duration in human-readable format"""
        if self.duration:
            hours = self.duration // 60
            minutes = self.duration % 60
            if hours > 0:
                return f"{hours}h {minutes}m"
            return f"{minutes} minutes"
        return "Duration not specified"
    
    def get_complexity_score(self):
        """Calculate lesson complexity for AI optimization"""
        score = 0
        
        # Basic content complexity
        if self.objectives and len(str(self.objectives)) > 500:
            score += 2
        if self.activities and len(str(self.activities)) > 1000:
            score += 3
        if self.assessment and len(str(self.assessment)) > 300:
            score += 1
        
        # Standards complexity
        if self.standards_alignment and len(self.standards_alignment) > 3:
            score += 2
        
        # Vocabulary complexity
        if self.vocabulary and len(self.vocabulary) > 10:
            score += 1
        
        return min(score, 10)  # Max score of 10
    
    def needs_substitute_version(self):
        """Check if lesson needs simplified substitute version"""
        complexity = self.get_complexity_score()
        return complexity > 5 or not self.substitute_version
    
    def get_ai_generation_info(self):
        """Return AI generation metadata"""
        return {
            'model': self.ai_model or 'unknown',
            'generated': self.generation_date.isoformat() if self.generation_date else None,
            'prompt_length': len(self.ai_prompt_used) if self.ai_prompt_used else 0,
            'is_ai_generated': self.is_ai_generated,
            'complexity_score': self.get_complexity_score()
        }
```

#### **A1.2: Create Vocabularies**
**File**: `backend/src/project/title/vocabularies/lesson_plan.py` **(NEW FILE)**
```python
"""
Vocabularies for Lesson Plan Content Type
"""

from zope.interface import implementer
from zope.schema.interfaces import IVocabularyFactory
from zope.schema.vocabulary import SimpleVocabulary, SimpleTerm


@implementer(IVocabularyFactory)
class SubjectsVocabulary(object):
    """Vocabulary of school subjects"""
    
    def __call__(self, context):
        subjects = [
            ('math', 'Mathematics'),
            ('english', 'English Language Arts'),
            ('science', 'Science'),
            ('social_studies', 'Social Studies'),
            ('history', 'History'),
            ('geography', 'Geography'),
            ('art', 'Art'),
            ('music', 'Music'),
            ('pe', 'Physical Education'),
            ('health', 'Health'),
            ('technology', 'Technology'),
            ('foreign_language', 'Foreign Language'),
        ]
        
        terms = [SimpleTerm(value=key, token=key, title=title) 
                for key, title in subjects]
        return SimpleVocabulary(terms)


@implementer(IVocabularyFactory)
class GradeLevelsVocabulary(object):
    """Vocabulary of grade levels"""
    
    def __call__(self, context):
        grades = [
            ('k', 'Kindergarten'),
            ('1', '1st Grade'),
            ('2', '2nd Grade'),
            ('3', '3rd Grade'),
            ('4', '4th Grade'),
            ('5', '5th Grade'),
            ('6', '6th Grade'),
            ('7', '7th Grade'),
            ('8', '8th Grade'),
            ('9', '9th Grade (Freshman)'),
            ('10', '10th Grade (Sophomore)'),
            ('11', '11th Grade (Junior)'),
            ('12', '12th Grade (Senior)'),
        ]
        
        terms = [SimpleTerm(value=key, token=key, title=title) 
                for key, title in grades]
        return SimpleVocabulary(terms)


# Factory instances
subjects_vocabulary = SubjectsVocabulary()
grade_levels_vocabulary = GradeLevelsVocabulary()
```

#### **A1.3: Register Content Type**
**File**: `backend/src/project/title/content/configure.zcml` **(ENHANCE EXISTING)**
```xml
<!-- ADD to existing configure.zcml -->

<five:registerClass
    class=".lesson_plan.LessonPlan"
    meta_type="LessonPlan"
    permission="cmf.AddPortalContent"
    />
```

#### **A1.4: Add to Types Configuration**
**File**: `backend/src/project/title/profiles/default/types.xml` **(ENHANCE EXISTING)**
```xml
<!-- ADD to existing types.xml -->

<object meta_type="Dexterity FTI"
        name="LessonPlan"
        filename="types/LessonPlan.xml"
/>
```

#### **A1.5: Create Type Definition**
**File**: `backend/src/project/title/profiles/default/types/LessonPlan.xml` **(NEW FILE)**
```xml
<?xml version="1.0"?>
<object name="LessonPlan" meta_type="Dexterity FTI" i18n:domain="plone"
        xmlns:i18n="http://xml.zope.org/namespaces/i18n">
 <property name="title" i18n:translate="">Lesson Plan</property>
 <property name="description" i18n:translate="">AI-generated lesson plan for classroom teaching</property>
 <property name="icon_expr">string:${portal_url}/document_icon.png</property>
 <property name="factory">LessonPlan</property>
 <property name="add_view_expr">string:${folder_url}/++add++LessonPlan</property>
 <property name="link_target"></property>
 <property name="immediate_view">view</property>
 <property name="global_allow">True</property>
 <property name="filter_content_types">True</property>
 <property name="allowed_content_types">
 </property>
 <property name="allow_discussion">False</property>
 <property name="default_view">view</property>
 <property name="view_methods">
  <element value="view"/>
 </property>
 <property name="default_view_fallback">False</property>
 <property name="add_permission">cmf.AddPortalContent</property>
 <property name="klass">project.title.content.lesson_plan.LessonPlan</property>
 <property name="model_source"></property>
 <property name="model_file"></property>
 <property name="schema">project.title.content.lesson_plan.ILessonPlan</property>
 <property name="behaviors">
  <element value="plone.dublincore"/>
  <element value="plone.namefromtitle"/>
 </property>
 <alias from="(Default)" to="(dynamic view)"/>
 <alias from="edit" to="@@edit"/>
 <alias from="sharing" to="@@sharing"/>
 <alias from="view" to="(selected layout)"/>
 <action title="View" action_id="view" category="object" condition_expr=""
         description="" icon_expr="" link_target="" url_expr="string:${object_url}"
         visible="True">
  <permission value="View"/>
 </action>
 <action title="Edit" action_id="edit" category="object" condition_expr=""
         description="" icon_expr="" link_target=""
         url_expr="string:${object_url}/edit" visible="True">
  <permission value="Modify portal content"/>
 </action>
</object>
```

#### **A1.6: Register Vocabularies**
**File**: `backend/src/project/title/vocabularies/configure.zcml` **(ENHANCE EXISTING)**
```xml
<!-- ADD to existing vocabularies configure.zcml -->

<utility
    component=".lesson_plan.subjects_vocabulary"
    name="project.title.vocabularies.subjects"
    />

<utility
    component=".lesson_plan.grade_levels_vocabulary"
    name="project.title.vocabularies.grade_levels"
    />
```

#### **A1.7: Update Content Package Init**
**File**: `backend/src/project/title/content/__init__.py` **(ENHANCE EXISTING)**
```python
# ADD to existing imports
from .lesson_plan import ILessonPlan, LessonPlan

__all__ = [
    'ISeatingChart',
    'SeatingChart',
    'IHallPass',
    'HallPass',
    'ILessonPlan',  # ADD
    'LessonPlan',   # ADD
]
```

---

## **PHASE B: AI Service Integration** 🤖 *3-4 hours*

### **B1: Create AI Service Layer**

#### **B1.1: AI Service Configuration**
**File**: `backend/src/project/title/ai_service.py` **(NEW FILE)**
```python
"""
AI Service Integration for Lesson Plan Generation

Supports OpenAI GPT and Claude APIs with fallback handling
and educational prompt optimization.
"""

import os
import json
import logging
from typing import Dict, List, Optional, Any
from datetime import datetime
import openai
import anthropic
from plone import api

logger = logging.getLogger(__name__)


class AIServiceError(Exception):
    """Custom exception for AI service errors"""
    pass


class LessonPlanAI:
    """AI service for generating educational content"""
    
    def __init__(self):
        self.openai_key = os.environ.get('OPENAI_API_KEY')
        self.claude_key = os.environ.get('ANTHROPIC_API_KEY')
        self.preferred_model = os.environ.get('AI_MODEL_PREFERENCE', 'openai')
        
        # Initialize clients
        if self.openai_key:
            openai.api_key = self.openai_key
        
        if self.claude_key:
            self.claude_client = anthropic.Anthropic(api_key=self.claude_key)
    
    def is_available(self) -> bool:
        """Check if any AI service is available"""
        return bool(self.openai_key or self.claude_key)
    
    def get_available_models(self) -> List[str]:
        """Return list of available AI models"""
        models = []
        if self.openai_key:
            models.extend(['gpt-4', 'gpt-3.5-turbo'])
        if self.claude_key:
            models.extend(['claude-3-opus', 'claude-3-sonnet'])
        return models
    
    def generate_lesson_plan(
        self,
        subject: str,
        grade_level: str,
        topic: str,
        duration: int = 50,
        standards: List[str] = None,
        special_requirements: str = "",
        model: str = None
    ) -> Dict[str, Any]:
        """
        Generate a complete lesson plan using AI
        
        Args:
            subject: Academic subject (Math, English, etc.)
            grade_level: Target grade level
            topic: Lesson topic/theme
            duration: Lesson duration in minutes
            standards: List of curriculum standards to address
            special_requirements: Special needs, accommodations, etc.
            model: Preferred AI model to use
            
        Returns:
            Dictionary containing generated lesson plan content
        """
        if not self.is_available():
            raise AIServiceError("No AI service configured. Set OPENAI_API_KEY or ANTHROPIC_API_KEY")
        
        # Build the prompt
        prompt = self._build_lesson_plan_prompt(
            subject, grade_level, topic, duration, standards, special_requirements
        )
        
        # Choose model and generate
        model = model or self.preferred_model
        
        try:
            if model.startswith('gpt') and self.openai_key:
                result = self._generate_with_openai(prompt, model)
            elif model.startswith('claude') and self.claude_key:
                result = self._generate_with_claude(prompt, model)
            else:
                # Fallback to available service
                if self.openai_key:
                    result = self._generate_with_openai(prompt, 'gpt-3.5-turbo')
                elif self.claude_key:
                    result = self._generate_with_claude(prompt, 'claude-3-sonnet')
                else:
                    raise AIServiceError("No available AI service")
            
            # Parse and structure the result
            lesson_data = self._parse_lesson_plan_response(result)
            
            # Add metadata
            lesson_data.update({
                'ai_model': model,
                'generation_date': datetime.now(),
                'prompt_used': prompt,
                'is_ai_generated': True
            })
            
            return lesson_data
            
        except Exception as e:
            logger.error(f"AI lesson generation failed: {e}")
            raise AIServiceError(f"Failed to generate lesson plan: {str(e)}")
    
    def generate_substitute_version(self, lesson_plan_content: Dict[str, Any]) -> str:
        """Generate simplified version for substitute teachers"""
        prompt = f"""
        Create a simplified version of this lesson plan for a substitute teacher who is 
        not familiar with the subject or students. Make it very clear and step-by-step.
        
        Original Lesson:
        Title: {lesson_plan_content.get('title', 'Unknown')}
        Subject: {lesson_plan_content.get('subject', 'Unknown')}
        Duration: {lesson_plan_content.get('duration', 50)} minutes
        
        Activities: {lesson_plan_content.get('activities', 'Not specified')}
        
        Create a substitute-friendly version that includes:
        1. Simple step-by-step instructions
        2. Exact timing for each activity
        3. What to do if students finish early
        4. Common behavior management tips
        5. Emergency contact information
        
        Keep it under 500 words and very practical.
        """
        
        try:
            if self.openai_key:
                response = self._generate_with_openai(prompt, 'gpt-3.5-turbo')
            elif self.claude_key:
                response = self._generate_with_claude(prompt, 'claude-3-sonnet')
            else:
                return "Substitute version unavailable - no AI service configured"
            
            return response.strip()
            
        except Exception as e:
            logger.error(f"Substitute version generation failed: {e}")
            return f"Error generating substitute version: {str(e)}"
    
    def _build_lesson_plan_prompt(
        self,
        subject: str,
        grade_level: str,
        topic: str,
        duration: int,
        standards: List[str] = None,
        special_requirements: str = ""
    ) -> str:
        """Build optimized prompt for lesson plan generation"""
        
        standards_text = ""
        if standards:
            standards_text = f"\nStandards to address: {', '.join(standards)}"
        
        special_text = ""
        if special_requirements:
            special_text = f"\nSpecial requirements: {special_requirements}"
        
        prompt = f"""
        Create a detailed lesson plan for {grade_level} grade {subject} on the topic of "{topic}".
        Duration: {duration} minutes{standards_text}{special_text}
        
        Please provide a comprehensive lesson plan with the following sections:
        
        LEARNING OBJECTIVES:
        - Write 3-5 clear, measurable learning objectives using action verbs
        - Align with grade-level expectations
        
        MATERIALS NEEDED:
        - List all materials, resources, and technology required
        - Include any handouts or digital resources
        
        LESSON ACTIVITIES:
        - Opening/Hook (5-10 minutes): Engaging way to start the lesson
        - Direct Instruction (15-20 minutes): Core content delivery
        - Guided Practice (10-15 minutes): Students practice with support
        - Independent Practice (10-15 minutes): Students work independently
        - Closure (5 minutes): Wrap-up and review
        
        ASSESSMENT METHODS:
        - Formative assessment strategies during the lesson
        - Summative assessment options
        - How to check for understanding
        
        DIFFERENTIATION:
        - Accommodations for different learning styles
        - Support for struggling learners
        - Extensions for advanced students
        
        KEY VOCABULARY:
        - List 5-8 important terms students should learn
        - Include simple definitions
        
        HOMEWORK/EXTENSION:
        - Optional homework assignment
        - Additional practice or enrichment activities
        
        Format the response clearly with headers and bullet points.
        Make it practical and teacher-friendly.
        """
        
        return prompt
    
    def _generate_with_openai(self, prompt: str, model: str = 'gpt-3.5-turbo') -> str:
        """Generate content using OpenAI API"""
        try:
            response = openai.ChatCompletion.create(
                model=model,
                messages=[
                    {
                        "role": "system",
                        "content": "You are an expert educational consultant who creates detailed, practical lesson plans for K-12 teachers. Your lesson plans are clear, engaging, and aligned with educational best practices."
                    },
                    {
                        "role": "user", 
                        "content": prompt
                    }
                ],
                max_tokens=2000,
                temperature=0.7,
                top_p=1.0,
                frequency_penalty=0.1,
                presence_penalty=0.1
            )
            
            return response.choices[0].message.content.strip()
            
        except Exception as e:
            logger.error(f"OpenAI API error: {e}")
            raise AIServiceError(f"OpenAI generation failed: {str(e)}")
    
    def _generate_with_claude(self, prompt: str, model: str = 'claude-3-sonnet-20240229') -> str:
        """Generate content using Claude API"""
        try:
            response = self.claude_client.messages.create(
                model=model,
                max_tokens=2000,
                temperature=0.7,
                system="You are an expert educational consultant who creates detailed, practical lesson plans for K-12 teachers. Your lesson plans are clear, engaging, and aligned with educational best practices.",
                messages=[
                    {
                        "role": "user",
                        "content": prompt
                    }
                ]
            )
            
            return response.content[0].text.strip()
            
        except Exception as e:
            logger.error(f"Claude API error: {e}")
            raise AIServiceError(f"Claude generation failed: {str(e)}")
    
    def _parse_lesson_plan_response(self, ai_response: str) -> Dict[str, Any]:
        """Parse AI response into structured lesson plan data"""
        try:
            # This is a simplified parser - you might want to use more sophisticated NLP
            sections = {}
            current_section = None
            current_content = []
            
            lines = ai_response.split('\n')
            
            for line in lines:
                line = line.strip()
                if not line:
                    continue
                
                # Check if this line is a section header
                if any(header in line.upper() for header in [
                    'LEARNING OBJECTIVES', 'OBJECTIVES',
                    'MATERIALS', 'RESOURCES',
                    'ACTIVITIES', 'PROCEDURES', 'LESSON ACTIVITIES',
                    'ASSESSMENT', 'EVALUATION',
                    'DIFFERENTIATION', 'ACCOMMODATIONS',
                    'VOCABULARY', 'KEY TERMS',
                    'HOMEWORK', 'EXTENSION'
                ]):
                    # Save previous section
                    if current_section and current_content:
                        sections[current_section] = '\n'.join(current_content)
                    
                    # Start new section
                    current_section = line.replace(':', '').strip()
                    current_content = []
                else:
                    # Add to current section
                    if current_section:
                        current_content.append(line)
            
            # Save last section
            if current_section and current_content:
                sections[current_section] = '\n'.join(current_content)
            
            # Map sections to expected fields
            lesson_data = {
                'objectives': self._extract_section(sections, ['LEARNING OBJECTIVES', 'OBJECTIVES']),
                'materials': self._extract_section(sections, ['MATERIALS', 'RESOURCES', 'MATERIALS NEEDED']),
                'activities': self._extract_section(sections, ['ACTIVITIES', 'PROCEDURES', 'LESSON ACTIVITIES']),
                'assessment': self._extract_section(sections, ['ASSESSMENT', 'EVALUATION', 'ASSESSMENT METHODS']),
                'differentiation': self._extract_section(sections, ['DIFFERENTIATION', 'ACCOMMODATIONS']),
                'vocabulary': self._extract_vocabulary(sections),
                'homework': self._extract_section(sections, ['HOMEWORK', 'EXTENSION'])
            }
            
            # Clean up empty sections
            lesson_data = {k: v for k, v in lesson_data.items() if v and v.strip()}
            
            return lesson_data
            
        except Exception as e:
            logger.error(f"Failed to parse AI response: {e}")
            # Fallback: return raw response
            return {
                'activities': ai_response,
                'objectives': 'AI-generated content (parsing failed)',
                'materials': 'See activities section',
                'assessment': 'Teacher observation and student work',
                'differentiation': 'Accommodate based on student needs'
            }
    
    def _extract_section(self, sections: Dict[str, str], possible_keys: List[str]) -> str:
        """Extract section content by trying multiple possible keys"""
        for key in possible_keys:
            for section_name, content in sections.items():
                if key.upper() in section_name.upper():
                    return content
        return ""
    
    def _extract_vocabulary(self, sections: Dict[str, str]) -> List[str]:
        """Extract vocabulary terms from sections"""
        vocab_content = self._extract_section(sections, ['VOCABULARY', 'KEY TERMS', 'KEY VOCABULARY'])
        if not vocab_content:
            return []
        
        # Simple extraction - look for terms (this could be improved)
        terms = []
        for line in vocab_content.split('\n'):
            line = line.strip()
            if line and not line.startswith('#'):
                # Remove bullet points and numbers
                cleaned = line.lstrip('•-*1234567890. ').strip()
                if cleaned:
                    # Take just the term (before colon or dash if present)
                    term = cleaned.split(':')[0].split('-')[0].strip()
                    if term and len(term) < 50:  # Reasonable term length
                        terms.append(term)
        
        return terms[:10]  # Limit to 10 terms


# Singleton instance
lesson_plan_ai = LessonPlanAI()
```

#### **B1.2: Environment Configuration**
**File**: `backend/src/project/title/profiles/default/registry.xml` **(ENHANCE EXISTING)**
```xml
<!-- ADD to existing registry.xml -->

<!-- AI Service Configuration -->
<records interface="project.title.interfaces.IAISettings"
         prefix="project.title.ai">
  <value key="enabled">True</value>
  <value key="default_model">gpt-3.5-turbo</value>
  <value key="max_tokens">2000</value>
  <value key="temperature">0.7</value>
  <value key="cache_responses">True</value>
  <value key="cache_duration">3600</value>
</records>
```

#### **B1.3: AI Settings Interface**
**File**: `backend/src/project/title/interfaces.py` **(NEW FILE OR ENHANCE EXISTING)**
```python
"""
Configuration interfaces for project.title
"""

from zope.interface import Interface
from zope import schema


class IAISettings(Interface):
    """Settings for AI service integration"""
    
    enabled = schema.Bool(
        title="Enable AI Features",
        description="Whether AI-powered features are enabled",
        default=True,
    )
    
    default_model = schema.Choice(
        title="Default AI Model",
        description="Which AI model to use by default",
        values=['gpt-4', 'gpt-3.5-turbo', 'claude-3-opus', 'claude-3-sonnet'],
        default='gpt-3.5-turbo',
    )
    
    max_tokens = schema.Int(
        title="Maximum Tokens",
        description="Maximum tokens for AI responses",
        default=2000,
        min=100,
        max=4000,
    )
    
    temperature = schema.Float(
        title="AI Temperature",
        description="Creativity level (0.0 = focused, 1.0 = creative)",
        default=0.7,
        min=0.0,
        max=1.0,
    )
    
    cache_responses = schema.Bool(
        title="Cache AI Responses",
        description="Whether to cache AI responses for performance",
        default=True,
    )
    
    cache_duration = schema.Int(
        title="Cache Duration (seconds)",
        description="How long to cache AI responses",
        default=3600,  # 1 hour
        min=60,
        max=86400,  # 24 hours
    )
```

---

## **PHASE C: Browser Views & AI Integration** 🔧 *3-4 hours*

### **C1: Create AI Lesson Plan Views**

#### **C1.1: Main Lesson Plan Generator View**
**File**: `backend/src/project/title/browser/ai_lesson_planner.py` **(NEW FILE)**
```python
"""
AI Lesson Plan Generator Browser Views

Provides web interface for AI-powered lesson plan generation
with integration into existing classroom management features.
"""

from Products.Five.browser import BrowserView
from plone import api
from plone.memoize import ram
from zope.annotation.interfaces import IAnnotations
from datetime import datetime, timedelta
import json
import logging
import time
import traceback

from ..ai_service import lesson_plan_ai, AIServiceError

logger = logging.getLogger(__name__)


class AILessonPlannerView(BrowserView):
    """Main view for AI lesson plan generation"""
    
    def __call__(self):
        """Handle both GET (form) and POST (generation) requests"""
        if self.request.method == 'POST':
            return self.generate_lesson_plan()
        else:
            return self.index()
    
    def generate_lesson_plan(self):
        """Generate lesson plan using AI service"""
        try:
            # Extract form data
            form_data = self._extract_form_data()
            
            # Validate required fields
            validation_errors = self._validate_form_data(form_data)
            if validation_errors:
                self.request.response.setStatus(400)
                return json.dumps({
                    'success': False,
                    'errors': validation_errors
                })
            
            # Check AI service availability
            if not lesson_plan_ai.is_available():
                self.request.response.setStatus(503)
                return json.dumps({
                    'success': False,
                    'error': 'AI service not configured. Please contact administrator.'
                })
            
            # Generate lesson plan
            logger.info(f"🤖 Generating lesson plan: {form_data['subject']} - {form_data['topic']}")
            
            lesson_data = lesson_plan_ai.generate_lesson_plan(
                subject=form_data['subject'],
                grade_level=form_data['grade_level'],
                topic=form_data['topic'],
                duration=form_data['duration'],
                standards=form_data.get('standards', []),
                special_requirements=form_data.get('special_requirements', ''),
                model=form_data.get('ai_model')
            )
            
            # Create lesson plan content object
            lesson_plan = self._create_lesson_plan_object(form_data, lesson_data)
            
            # Generate substitute version if requested
            if form_data.get('generate_substitute_version', False):
                substitute_content = lesson_plan_ai.generate_substitute_version(lesson_data)
                lesson_plan.substitute_version = api.content.RichTextValue(
                    substitute_content,
                    'text/html',
                    'text/x-html-safe'
                )
                lesson_plan.reindexObject()
            
            # Update generation statistics
            self._update_generation_stats(form_data, lesson_data)
            
            logger.info(f"✅ Lesson plan created: {lesson_plan.absolute_url()}")
            
            self.request.response.setHeader('Content-Type', 'application/json')
            return json.dumps({
                'success': True,
                'lesson_plan_id': lesson_plan.getId(),
                'lesson_plan_url': lesson_plan.absolute_url(),
                'title': lesson_plan.title,
                'duration': lesson_plan.duration,
                'complexity_score': lesson_plan.get_complexity_score(),
                'ai_model': lesson_data.get('ai_model', 'unknown')
            })
            
        except AIServiceError as e:
            logger.error(f"❌ AI service error: {e}")
            self.request.response.setStatus(503)
            return json.dumps({
                'success': False,
                'error': f'AI generation failed: {str(e)}'
            })
        except Exception as e:
            logger.error(f"❌ Lesson generation error: {e}")
            logger.error(traceback.format_exc())
            self.request.response.setStatus(500)
            return json.dumps({
                'success': False,
                'error': f'Unexpected error: {str(e)}'
            })
    
    def _extract_form_data(self):
        """Extract and clean form data from request"""
        form = self.request.form
        
        # Handle both form data and JSON body
        if self.request.get('CONTENT_TYPE', '').startswith('application/json'):
            body = self.request.get('BODY', '{}')
            if isinstance(body, bytes):
                body = body.decode('utf-8')
            form.update(json.loads(body))
        
        # Extract standards (could be comma-separated string or list)
        standards = form.get('standards', [])
        if isinstance(standards, str):
            standards = [s.strip() for s in standards.split(',') if s.strip()]
        
        return {
            'subject': form.get('subject', '').strip(),
            'grade_level': form.get('grade_level', '').strip(),
            'topic': form.get('topic', '').strip(),
            'duration': int(form.get('duration', 50)),
            'standards': standards,
            'special_requirements': form.get('special_requirements', '').strip(),
            'ai_model': form.get('ai_model', ''),
            'generate_substitute_version': form.get('generate_substitute_version', False),
            'lesson_date': form.get('lesson_date', ''),
            'emergency_contact': form.get('emergency_contact', '').strip()
        }
    
    def _validate_form_data(self, form_data):
        """Validate form data and return list of errors"""
        errors = []
        
        if not form_data['subject']:
            errors.append('Subject is required')
        
        if not form_data['grade_level']:
            errors.append('Grade level is required')
        
        if not form_data['topic']:
            errors.append('Topic is required')
        
        if form_data['duration'] < 15 or form_data['duration'] > 180:
            errors.append('Duration must be between 15 and 180 minutes')
        
        return errors
    
    def _create_lesson_plan_object(self, form_data, lesson_data):
        """Create Plone content object from generated lesson plan"""
        # Generate title
        title = f"{form_data['subject']} - {form_data['topic']} (Grade {form_data['grade_level']})"
        
        # Create unique ID
        base_id = api.content.get_uuid()[:8]
        lesson_id = f"lesson-{form_data['subject'].lower()}-{base_id}"
        
        # Parse lesson date
        lesson_date = None
        if form_data.get('lesson_date'):
            try:
                lesson_date = datetime.strptime(form_data['lesson_date'], '%Y-%m-%d').date()
            except ValueError:
                lesson_date = None
        
        # Create the lesson plan object
        with api.env.adopt_roles(['Manager']):
            lesson_plan = api.content.create(
                container=self.context,
                type='LessonPlan',
                id=lesson_id,
                title=title,
                description=f"AI-generated lesson plan for {form_data['topic']} in {form_data['subject']}",
                subject=form_data['subject'],
                grade_level=form_data['grade_level'],
                duration=form_data['duration'],
                lesson_date=lesson_date,
                standards_alignment=form_data.get('standards', []),
                emergency_contact=form_data.get('emergency_contact', ''),
                ai_prompt_used=lesson_data.get('prompt_used', ''),
                ai_model=lesson_data.get('ai_model', 'unknown'),
                generation_date=lesson_data.get('generation_date', datetime.now()),
                is_ai_generated=True
            )
        
        # Set rich text fields
        if lesson_data.get('objectives'):
            lesson_plan.objectives = api.content.RichTextValue(
                lesson_data['objectives'],
                'text/html',
                'text/x-html-safe'
            )
        
        if lesson_data.get('materials'):
            lesson_plan.materials = api.content.RichTextValue(
                lesson_data['materials'],
                'text/html',
                'text/x-html-safe'
            )
        
        if lesson_data.get('activities'):
            lesson_plan.activities = api.content.RichTextValue(
                lesson_data['activities'],
                'text/html',
                'text/x-html-safe'
            )
        
        if lesson_data.get('assessment'):
            lesson_plan.assessment = api.content.RichTextValue(
                lesson_data['assessment'],
                'text/html',
                'text/x-html-safe'
            )
        
        if lesson_data.get('differentiation'):
            lesson_plan.differentiation = api.content.RichTextValue(
                lesson_data['differentiation'],
                'text/html',
                'text/x-html-safe'
            )
        
        if lesson_data.get('homework'):
            lesson_plan.homework = api.content.RichTextValue(
                lesson_data['homework'],
                'text/html',
                'text/x-html-safe'
            )
        
        # Set vocabulary
        if lesson_data.get('vocabulary'):
            lesson_plan.vocabulary = lesson_data['vocabulary']
        
        # Set substitute notes if special requirements provided
        if form_data.get('special_requirements'):
            substitute_notes = f"Special Requirements: {form_data['special_requirements']}"
            lesson_plan.substitute_notes = api.content.RichTextValue(
                substitute_notes,
                'text/html',
                'text/x-html-safe'
            )
        
        # Publish the lesson plan
        try:
            api.content.transition(obj=lesson_plan, transition='publish')
        except:
            pass  # Ignore if workflow doesn't exist
        
        lesson_plan.reindexObject()
        
        return lesson_plan
    
    def _update_generation_stats(self, form_data, lesson_data):
        """Update AI generation statistics"""
        try:
            portal = api.portal.get()
            annotations = IAnnotations(portal)
            
            stats_key = 'ai_lesson_plan_stats'
            stats = annotations.get(stats_key, {
                'total_generated': 0,
                'by_subject': {},
                'by_grade': {},
                'by_model': {},
                'total_tokens_estimated': 0,
                'last_generation': None
            })
            
            # Update totals
            stats['total_generated'] += 1
            stats['last_generation'] = datetime.now().isoformat()
            
            # Update by subject
            subject = form_data['subject']
            stats['by_subject'][subject] = stats['by_subject'].get(subject, 0) + 1
            
            # Update by grade
            grade = form_data['grade_level']
            stats['by_grade'][grade] = stats['by_grade'].get(grade, 0) + 1
            
            # Update by model
            model = lesson_data.get('ai_model', 'unknown')
            stats['by_model'][model] = stats['by_model'].get(model, 0) + 1
            
            # Estimate tokens (rough approximation)
            content_length = sum(len(str(v)) for v in lesson_data.values())
            estimated_tokens = content_length // 4  # Rough token estimation
            stats['total_tokens_estimated'] += estimated_tokens
            
            annotations[stats_key] = stats
            
        except Exception as e:
            logger.warning(f"Failed to update generation stats: {e}")
    
    def get_ai_service_status(self):
        """Get AI service availability and configuration"""
        try:
            status = {
                'available': lesson_plan_ai.is_available(),
                'models': lesson_plan_ai.get_available_models(),
                'default_model': lesson_plan_ai.preferred_model,
                'openai_configured': bool(lesson_plan_ai.openai_key),
                'claude_configured': bool(lesson_plan_ai.claude_key)
            }
            
            self.request.response.setHeader('Content-Type', 'application/json')
            return json.dumps(status)
            
        except Exception as e:
            logger.error(f"Failed to get AI service status: {e}")
            self.request.response.setStatus(500)
            return json.dumps({
                'available': False,
                'error': str(e)
            })
    
    def get_generation_stats(self):
        """Get AI generation statistics"""
        try:
            portal = api.portal.get()
            annotations = IAnnotations(portal)
            
            stats_key = 'ai_lesson_plan_stats'
            stats = annotations.get(stats_key, {
                'total_generated': 0,
                'by_subject': {},
                'by_grade': {},
                'by_model': {},
                'total_tokens_estimated': 0,
                'last_generation': None
            })
            
            self.request.response.setHeader('Content-Type', 'application/json')
            return json.dumps(stats)
            
        except Exception as e:
            logger.error(f"Failed to get generation stats: {e}")
            self.request.response.setStatus(500)
            return json.dumps({'error': str(e)})
    
    @ram.cache(lambda *args: time.time() // 300)  # 5-minute cache
    def get_subject_suggestions(self):
        """Get subject-specific topic suggestions"""
        suggestions = {
            'math': [
                'Fractions and Decimals',
                'Algebraic Expressions',
                'Geometry and Shapes',
                'Data Analysis and Graphing',
                'Problem Solving Strategies'
            ],
            'english': [
                'Creative Writing Workshop',
                'Reading Comprehension Strategies',
                'Grammar and Punctuation',
                'Poetry Analysis',
                'Research Skills'
            ],
            'science': [
                'States of Matter',
                'Plant and Animal Cells',
                'Simple Machines',
                'Weather Patterns',
                'Scientific Method'
            ],
            'social_studies': [
                'Ancient Civilizations',
                'Government and Citizenship',
                'Geography Skills',
                'Historical Timelines',
                'Cultural Diversity'
            ]
        }
        
        self.request.response.setHeader('Content-Type', 'application/json')
        return json.dumps(suggestions)


class LessonPlanManagerView(BrowserView):
    """View for managing existing lesson plans"""
    
    def __call__(self):
        """Handle lesson plan management requests"""
        action = self.request.get('action', 'list')
        
        if action == 'list':
            return self.list_lesson_plans()
        elif action == 'duplicate':
            return self.duplicate_lesson_plan()
        elif action == 'regenerate_substitute':
            return self.regenerate_substitute_version()
        else:
            self.request.response.setStatus(400)
            return json.dumps({'error': 'Unknown action'})
    
    def list_lesson_plans(self):
        """List recent lesson plans with metadata"""
        try:
            catalog = api.portal.get_tool('portal_catalog')
            
            # Get recent lesson plans
            lessons = catalog(
                portal_type='LessonPlan',
                sort_on='created',
                sort_order='descending',
                sort_limit=20
            )
            
            lesson_data = []
            for brain in lessons:
                try:
                    obj = brain.getObject()
                    lesson_data.append({
                        'id': obj.getId(),
                        'title': obj.title,
                        'subject': getattr(obj, 'subject', 'Unknown'),
                        'grade_level': getattr(obj, 'grade_level', 'Unknown'),
                        'duration': getattr(obj, 'duration', 0),
                        'created': brain.created.strftime('%Y-%m-%d'),
                        'is_ai_generated': getattr(obj, 'is_ai_generated', False),
                        'ai_model': getattr(obj, 'ai_model', 'unknown'),
                        'complexity_score': obj.get_complexity_score(),
                        'url': obj.absolute_url(),
                        'has_substitute_version': bool(getattr(obj, 'substitute_version', None))
                    })
                except Exception as e:
                    logger.warning(f"Failed to process lesson plan {brain.getPath()}: {e}")
                    continue
            
            self.request.response.setHeader('Content-Type', 'application/json')
            return json.dumps({
                'success': True,
                'lesson_plans': lesson_data,
                'total_count': len(lesson_data)
            })
            
        except Exception as e:
            logger.error(f"Failed to list lesson plans: {e}")
            self.request.response.setStatus(500)
            return json.dumps({
                'success': False,
                'error': str(e)
            })
    
    def duplicate_lesson_plan(self):
        """Create a copy of an existing lesson plan for modification"""
        try:
            lesson_id = self.request.get('lesson_id')
            if not lesson_id:
                self.request.response.setStatus(400)
                return json.dumps({'error': 'lesson_id required'})
            
            # Get original lesson
            original = api.content.get(UID=lesson_id)
            if not original:
                self.request.response.setStatus(404)
                return json.dumps({'error': 'Lesson plan not found'})
            
            # Create duplicate
            new_title = f"Copy of {original.title}"
            new_id = f"copy-{api.content.get_uuid()[:8]}"
            
            duplicate = api.content.copy(
                source=original,
                target=original.aq_parent,
                id=new_id,
                safe_id=True
            )
            
            duplicate.title = new_title
            duplicate.is_ai_generated = False  # Mark as manually modified
            duplicate.reindexObject()
            
            logger.info(f"✅ Lesson plan duplicated: {duplicate.absolute_url()}")
            
            self.request.response.setHeader('Content-Type', 'application/json')
            return json.dumps({
                'success': True,
                'duplicate_id': duplicate.getId(),
                'duplicate_url': duplicate.absolute_url(),
                'title': duplicate.title
            })
            
        except Exception as e:
            logger.error(f"Failed to duplicate lesson plan: {e}")
            self.request.response.setStatus(500)
            return json.dumps({
                'success': False,
                'error': str(e)
            })
    
    def regenerate_substitute_version(self):
        """Regenerate substitute teacher version of lesson plan"""
        try:
            lesson_id = self.request.get('lesson_id')
            if not lesson_id:
                self.request.response.setStatus(400)
                return json.dumps({'error': 'lesson_id required'})
            
            # Get lesson plan
            lesson_plan = api.content.get(UID=lesson_id)
            if not lesson_plan:
                self.request.response.setStatus(404)
                return json.dumps({'error': 'Lesson plan not found'})
            
            # Check AI service
            if not lesson_plan_ai.is_available():
                self.request.response.setStatus(503)
                return json.dumps({'error': 'AI service not available'})
            
            # Prepare lesson content for AI
            lesson_content = {
                'title': lesson_plan.title,
                'subject': getattr(lesson_plan, 'subject', ''),
                'duration': getattr(lesson_plan, 'duration', 50),
                'activities': str(getattr(lesson_plan, 'activities', ''))
            }
            
            # Generate substitute version
            substitute_content = lesson_plan_ai.generate_substitute_version(lesson_content)
            
            # Update lesson plan
            lesson_plan.substitute_version = api.content.RichTextValue(
                substitute_content,
                'text/html',
                'text/x-html-safe'
            )
            lesson_plan.reindexObject()
            
            logger.info(f"✅ Substitute version regenerated for: {lesson_plan.title}")
            
            self.request.response.setHeader('Content-Type', 'application/json')
            return json.dumps({
                'success': True,
                'substitute_content': substitute_content[:200] + '...'  # Preview
            })
            
        except Exception as e:
            logger.error(f"Failed to regenerate substitute version: {e}")
            self.request.response.setStatus(500)
            return json.dumps({
                'success': False,
                'error': str(e)
            })
```

#### **C1.2: Register Browser Views**
**File**: `backend/src/project/title/browser/configure.zcml` **(ENHANCE EXISTING)**
```xml
<!-- ADD to existing configure.zcml -->

<!-- AI Lesson Plan Views -->
<browser:page
  name="ai-lesson-planner"
  for="*"
  class=".ai_lesson_planner.AILessonPlannerView"
  template="ai_lesson_planner.pt"
  permission="zope2.View"
  />

<browser:page
  name="generate-lesson-plan"
  for="*"
  class=".ai_lesson_planner.AILessonPlannerView"
  attribute="generate_lesson_plan"
  permission="cmf.AddPortalContent"
  />

<browser:page
  name="ai-service-status"
  for="*"
  class=".ai_lesson_planner.AILessonPlannerView"
  attribute="get_ai_service_status"
  permission="zope2.View"
  />

<browser:page
  name="ai-generation-stats"
  for="*"
  class=".ai_lesson_planner.AILessonPlannerView"
  attribute="get_generation_stats"
  permission="zope2.View"
  />

<browser:page
  name="subject-suggestions"
  for="*"
  class=".ai_lesson_planner.AILessonPlannerView"
  attribute="get_subject_suggestions"
  permission="zope2.View"
  />

<browser:page
  name="lesson-plan-manager"
  for="*"
  class=".ai_lesson_planner.LessonPlanManagerView"
  permission="zope2.View"
  />
```

#### **C1.3: Create Page Template**
**File**: `backend/src/project/title/browser/ai_lesson_planner.pt` **(NEW FILE)**
```html
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>

<metal:content-core fill-slot="content-core">
  <div class="ai-lesson-planner-view">
    
    <h1>AI Lesson Plan Generator</h1>
    
    <div class="description">
      <p>Generate comprehensive, standards-aligned lesson plans using artificial intelligence. 
         Save hours of planning time while creating engaging, educational content for your students.</p>
    </div>
    
    <div class="ai-service-status" id="ai-status">
      <div class="loading">Checking AI service availability...</div>
    </div>
    
    <div class="lesson-planner-form" id="lesson-form" style="display: none;">
      
      <form id="ai-lesson-form" method="post">
        
        <fieldset>
          <legend>Basic Information</legend>
          
          <div class="field">
            <label for="subject">Subject *</label>
            <select id="subject" name="subject" required>
              <option value="">Select Subject</option>
              <option value="math">Mathematics</option>
              <option value="english">English Language Arts</option>
              <option value="science">Science</option>
              <option value="social_studies">Social Studies</option>
              <option value="history">History</option>
              <option value="art">Art</option>
              <option value="music">Music</option>
              <option value="pe">Physical Education</option>
            </select>
          </div>
          
          <div class="field">
            <label for="grade_level">Grade Level *</label>
            <select id="grade_level" name="grade_level" required>
              <option value="">Select Grade</option>
              <option value="k">Kindergarten</option>
              <option value="1">1st Grade</option>
              <option value="2">2nd Grade</option>
              <option value="3">3rd Grade</option>
              <option value="4">4th Grade</option>
              <option value="5">5th Grade</option>
              <option value="6">6th Grade</option>
              <option value="7">7th Grade</option>
              <option value="8">8th Grade</option>
              <option value="9">9th Grade</option>
              <option value="10">10th Grade</option>
              <option value="11">11th Grade</option>
              <option value="12">12th Grade</option>
            </select>
          </div>
          
          <div class="field">
            <label for="topic">Lesson Topic *</label>
            <input type="text" id="topic" name="topic" required 
                   placeholder="e.g., Introduction to Fractions" />
            <div class="help-text">
              <span class="suggestions-toggle" onclick="toggleSuggestions()">
                💡 Show topic suggestions
              </span>
            </div>
            <div id="topic-suggestions" style="display: none;"></div>
          </div>
          
          <div class="field">
            <label for="duration">Duration (minutes) *</label>
            <input type="number" id="duration" name="duration" 
                   min="15" max="180" value="50" required />
          </div>
          
          <div class="field">
            <label for="lesson_date">Lesson Date</label>
            <input type="date" id="lesson_date" name="lesson_date" />
          </div>
          
        </fieldset>
        
        <fieldset>
          <legend>Standards & Requirements</legend>
          
          <div class="field">
            <label for="standards">Standards Alignment</label>
            <textarea id="standards" name="standards" rows="3"
                      placeholder="Enter curriculum standards, separated by commas"></textarea>
          </div>
          
          <div class="field">
            <label for="special_requirements">Special Requirements</label>
            <textarea id="special_requirements" name="special_requirements" rows="3"
                      placeholder="Accommodations, technology needs, etc."></textarea>
          </div>
          
        </fieldset>
        
        <fieldset>
          <legend>AI Options</legend>
          
          <div class="field">
            <label for="ai_model">AI Model</label>
            <select id="ai_model" name="ai_model">
              <option value="">Use Default</option>
            </select>
          </div>
          
          <div class="field checkbox">
            <input type="checkbox" id="generate_substitute_version" 
                   name="generate_substitute_version" value="true" />
            <label for="generate_substitute_version">
              Generate substitute teacher version
            </label>
          </div>
          
        </fieldset>
        
        <fieldset>
          <legend>Emergency Information</legend>
          
          <div class="field">
            <label for="emergency_contact">Emergency Contact</label>
            <input type="text" id="emergency_contact" name="emergency_contact"
                   placeholder="Name and phone number" />
          </div>
          
        </fieldset>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="generate-btn">
            🤖 Generate Lesson Plan
          </button>
          <button type="button" class="btn btn-secondary" onclick="resetForm()">
            Reset Form
          </button>
        </div>
        
      </form>
      
    </div>
    
    <div class="generation-result" id="generation-result" style="display: none;">
      <!-- Results will be populated by JavaScript -->
    </div>
    
    <div class="recent-lessons" id="recent-lessons">
      <h2>Recent Lesson Plans</h2>
      <div class="loading">Loading recent lesson plans...</div>
    </div>
    
  </div>
  
  <!-- JavaScript for AI Lesson Planner -->
  <script>
    // This would be implemented in Phase D - Frontend Integration
    console.log('AI Lesson Planner template loaded');
  </script>
  
</metal:content-core>

</body>
</html>
```

---

## **PHASE D: Frontend React Integration** ⚛️ *3-4 hours*

### **D1: Create React Components**

#### **D1.1: Main AI Lesson Planner Component**
**File**: `frontend/packages/volto-project-title/src/components/AI/AILessonPlanner.jsx` **(NEW FILE)**
```jsx
/**
 * AI Lesson Plan Generator Component
 * 
 * Provides form interface for generating lesson plans using AI,
 * with integration into existing classroom management features.
 */

import React, { useState, useEffect, useCallback } from 'react';
import PropTypes from 'prop-types';
import {
  Container,
  Segment,
  Header,
  Form,
  Button,
  Grid,
  Icon,
  Message,
  Label,
  Modal,
  Progress,
  Statistic,
  Dropdown,
  Checkbox
} from 'semantic-ui-react';
import { toast } from 'react-toastify';
import './AILessonPlanner.css';

const AILessonPlanner = ({ contentUrl = '', onLessonGenerated }) => {
  // Form state
  const [formData, setFormData] = useState({
    subject: '',
    grade_level: '',
    topic: '',
    duration: 50,
    lesson_date: '',
    standards: '',
    special_requirements: '',
    ai_model: '',
    generate_substitute_version: false,
    emergency_contact: ''
  });

  // UI state
  const [isGenerating, setIsGenerating] = useState(false);
  const [aiStatus, setAiStatus] = useState(null);
  const [generationStats, setGenerationStats] = useState(null);
  const [topicSuggestions, setTopicSuggestions] = useState({});
  const [recentLessons, setRecentLessons] = useState([]);
  const [showResult, setShowResult] = useState(false);
  const [generatedLesson, setGeneratedLesson] = useState(null);
  const [formErrors, setFormErrors] = useState({});

  // Load initial data
  useEffect(() => {
    Promise.all([
      fetchAIStatus(),
      fetchGenerationStats(),
      fetchTopicSuggestions(),
      fetchRecentLessons()
    ]).catch(error => {
      console.error('Failed to load initial data:', error);
      toast.error('Failed to load AI lesson planner data');
    });
  }, []);

  const fetchAIStatus = async () => {
    try {
      const response = await fetch('/@@ai-service-status');
      const data = await response.json();
      setAiStatus(data);
      
      if (!data.available) {
        toast.warning('AI service is not available. Please contact administrator.');
      }
    } catch (error) {
      console.error('Failed to fetch AI status:', error);
      setAiStatus({ available: false, error: 'Failed to check AI service' });
    }
  };

  const fetchGenerationStats = async () => {
    try {
      const response = await fetch('/@@ai-generation-stats');
      const data = await response.json();
      setGenerationStats(data);
    } catch (error) {
      console.error('Failed to fetch generation stats:', error);
    }
  };

  const fetchTopicSuggestions = async () => {
    try {
      const response = await fetch('/@@subject-suggestions');
      const data = await response.json();
      setTopicSuggestions(data);
    } catch (error) {
      console.error('Failed to fetch topic suggestions:', error);
    }
  };

  const fetchRecentLessons = async () => {
    try {
      const response = await fetch('/@@lesson-plan-manager?action=list');
      const data = await response.json();
      if (data.success) {
        setRecentLessons(data.lesson_plans);
      }
    } catch (error) {
      console.error('Failed to fetch recent lessons:', error);
    }
  };

  const handleInputChange = useCallback((e, { name, value, checked }) => {
    setFormData(prev => ({
      ...prev,
      [name]: checked !== undefined ? checked : value
    }));
    
    // Clear field-specific errors
    if (formErrors[name]) {
      setFormErrors(prev => ({ ...prev, [name]: null }));
    }
  }, [formErrors]);

  const validateForm = () => {
    const errors = {};
    
    if (!formData.subject) errors.subject = 'Subject is required';
    if (!formData.grade_level) errors.grade_level = 'Grade level is required';
    if (!formData.topic) errors.topic = 'Topic is required';
    if (formData.duration < 15 || formData.duration > 180) {
      errors.duration = 'Duration must be between 15 and 180 minutes';
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      toast.error('Please fix form errors before submitting');
      return;
    }
    
    if (!aiStatus?.available) {
      toast.error('AI service is not available');
      return;
    }

    setIsGenerating(true);
    setShowResult(false);

    try {
      const response = await fetch('/@@generate-lesson-plan', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      });

      const result = await response.json();

      if (result.success) {
        setGeneratedLesson(result);
        setShowResult(true);
        toast.success(`Lesson plan "${result.title}" generated successfully!`);
        
        // Refresh stats and recent lessons
        fetchGenerationStats();
        fetchRecentLessons();
        
        // Call parent callback if provided
        if (onLessonGenerated) {
          onLessonGenerated(result);
        }
      } else {
        toast.error(result.error || 'Failed to generate lesson plan');
        if (result.errors) {
          setFormErrors(result.errors.reduce((acc, error) => {
            const field = error.toLowerCase().includes('subject') ? 'subject' :
                         error.toLowerCase().includes('grade') ? 'grade_level' :
                         error.toLowerCase().includes('topic') ? 'topic' :
                         error.toLowerCase().includes('duration') ? 'duration' : 'general';
            acc[field] = error;
            return acc;
          }, {}));
        }
      }
    } catch (error) {
      console.error('Generation failed:', error);
      toast.error('Network error occurred while generating lesson plan');
    } finally {
      setIsGenerating(false);
    }
  };

  const resetForm = () => {
    setFormData({
      subject: '',
      grade_level: '',
      topic: '',
      duration: 50,
      lesson_date: '',
      standards: '',
      special_requirements: '',
      ai_model: '',
      generate_substitute_version: false,
      emergency_contact: ''
    });
    setFormErrors({});
    setShowResult(false);
    setGeneratedLesson(null);
  };

  const duplicateLesson = async (lessonId) => {
    try {
      const response = await fetch('/@@lesson-plan-manager', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'duplicate', lesson_id: lessonId })
      });
      
      const result = await response.json();
      if (result.success) {
        toast.success('Lesson plan duplicated successfully!');
        fetchRecentLessons();
      } else {
        toast.error(result.error || 'Failed to duplicate lesson plan');
      }
    } catch (error) {
      console.error('Duplication failed:', error);
      toast.error('Failed to duplicate lesson plan');
    }
  };

  // Subject options
  const subjectOptions = [
    { key: 'math', value: 'math', text: 'Mathematics' },
    { key: 'english', value: 'english', text: 'English Language Arts' },
    { key: 'science', value: 'science', text: 'Science' },
    { key: 'social_studies', value: 'social_studies', text: 'Social Studies' },
    { key: 'history', value: 'history', text: 'History' },
    { key: 'art', value: 'art', text: 'Art' },
    { key: 'music', value: 'music', text: 'Music' },
    { key: 'pe', value: 'pe', text: 'Physical Education' }
  ];

  // Grade level options
  const gradeOptions = [
    { key: 'k', value: 'k', text: 'Kindergarten' },
    { key: '1', value: '1', text: '1st Grade' },
    { key: '2', value: '2', text: '2nd Grade' },
    { key: '3', value: '3', text: '3rd Grade' },
    { key: '4', value: '4', text: '4th Grade' },
    { key: '5', value: '5', text: '5th Grade' },
    { key: '6', value: '6', text: '6th Grade' },
    { key: '7', value: '7', text: '7th Grade' },
    { key: '8', value: '8', text: '8th Grade' },
    { key: '9', value: '9', text: '9th Grade' },
    { key: '10', value: '10', text: '10th Grade' },
    { key: '11', value: '11', text: '11th Grade' },
    { key: '12', value: '12', text: '12th Grade' }
  ];

  // AI model options (from status)
  const modelOptions = aiStatus?.models?.map(model => ({
    key: model,
    value: model,
    text: model.toUpperCase()
  })) || [];

  return (
    <Container fluid className="ai-lesson-planner">
      <Header as="h1" icon textAlign="center">
        <Icon name="magic" />
        AI Lesson Plan Generator
        <Header.Subheader>
          Save hours of planning time with AI-generated, standards-aligned lesson plans
        </Header.Subheader>
      </Header>

      {/* AI Service Status */}
      {aiStatus && (
        <Segment className="ai-status">
          <Grid columns={4} divided>
            <Grid.Column>
              <Statistic size="mini">
                <Statistic.Value>
                  <Icon name={aiStatus.available ? 'checkmark' : 'x'} 
                        color={aiStatus.available ? 'green' : 'red'} />
                </Statistic.Value>
                <Statistic.Label>AI Service</Statistic.Label>
              </Statistic>
            </Grid.Column>
            <Grid.Column>
              <Statistic size="mini">
                <Statistic.Value>
                  {aiStatus.models?.length || 0}
                </Statistic.Value>
                <Statistic.Label>Models Available</Statistic.Label>
              </Statistic>
            </Grid.Column>
            <Grid.Column>
              <Statistic size="mini">
                <Statistic.Value>
                  {generationStats?.total_generated || 0}
                </Statistic.Value>
                <Statistic.Label>Plans Generated</Statistic.Label>
              </Statistic>
            </Grid.Column>
            <Grid.Column>
              <Statistic size="mini">
                <Statistic.Value>
                  <Icon name="clock" />
                </Statistic.Value>
                <Statistic.Label>3-5 Hours Saved</Statistic.Label>
              </Statistic>
            </Grid.Column>
          </Grid>
        </Segment>
      )}

      <Grid columns={2} stackable>
        <Grid.Column width={10}>
          {/* Generation Form */}
          <Segment className="generation-form">
            <Header as="h2">
              <Icon name="edit" />
              Create New Lesson Plan
            </Header>

            <Form onSubmit={handleSubmit} loading={isGenerating}>
              <Form.Group widths="equal">
                <Form.Select
                  label="Subject"
                  name="subject"
                  placeholder="Select Subject"
                  options={subjectOptions}
                  value={formData.subject}
                  onChange={handleInputChange}
                  required
                  error={formErrors.subject}
                />
                <Form.Select
                  label="Grade Level"
                  name="grade_level"
                  placeholder="Select Grade"
                  options={gradeOptions}
                  value={formData.grade_level}
                  onChange={handleInputChange}
                  required
                  error={formErrors.grade_level}
                />
              </Form.Group>

              <Form.Input
                label="Lesson Topic"
                name="topic"
                placeholder="e.g., Introduction to Fractions"
                value={formData.topic}
                onChange={handleInputChange}
                required
                error={formErrors.topic}
              />

              {/* Topic Suggestions */}
              {formData.subject && topicSuggestions[formData.subject] && (
                <Message info>
                  <Message.Header>Topic Suggestions for {formData.subject}:</Message.Header>
                  <div className="topic-suggestions">
                    {topicSuggestions[formData.subject].map((suggestion, index) => (
                      <Label 
                        key={index}
                        as="a"
                        onClick={() => setFormData(prev => ({ ...prev, topic: suggestion }))}
                        style={{ margin: '2px', cursor: 'pointer' }}
                      >
                        {suggestion}
                      </Label>
                    ))}
                  </div>
                </Message>
              )}

              <Form.Group widths="equal">
                <Form.Input
                  label="Duration (minutes)"
                  name="duration"
                  type="number"
                  min="15"
                  max="180"
                  value={formData.duration}
                  onChange={handleInputChange}
                  required
                  error={formErrors.duration}
                />
                <Form.Input
                  label="Lesson Date"
                  name="lesson_date"
                  type="date"
                  value={formData.lesson_date}
                  onChange={handleInputChange}
                />
              </Form.Group>

              <Form.TextArea
                label="Standards Alignment"
                name="standards"
                placeholder="Enter curriculum standards, separated by commas"
                value={formData.standards}
                onChange={handleInputChange}
                rows={2}
              />

              <Form.TextArea
                label="Special Requirements"
                name="special_requirements"
                placeholder="Accommodations, technology needs, behavioral considerations, etc."
                value={formData.standards}
                onChange={handleInputChange}
                rows={3}
              />

              <Form.Group>
                <Form.Select
                  label="AI Model (Optional)"
                  name="ai_model"
                  placeholder="Use Default"
                  options={modelOptions}
                  value={formData.ai_model}
                  onChange={handleInputChange}
                  width={8}
                />
                <Form.Input
                  label="Emergency Contact"
                  name="emergency_contact"
                  placeholder="Name and phone number"
                  value={formData.emergency_contact}
                  onChange={handleInputChange}
                  width={8}
                />
              </Form.Group>

              <Form.Field>
                <Checkbox
                  label="Generate substitute teacher version"
                  name="generate_substitute_version"
                  checked={formData.generate_substitute_version}
                  onChange={handleInputChange}
                />
              </Form.Field>

              <Form.Group>
                <Button 
                  type="submit" 
                  primary 
                  size="large"
                  disabled={!aiStatus?.available || isGenerating}
                  loading={isGenerating}
                >
                  <Icon name="magic" />
                  Generate Lesson Plan
                </Button>
                <Button 
                  type="button" 
                  secondary 
                  size="large"
                  onClick={resetForm}
                >
                  Reset Form
                </Button>
              </Form.Group>
            </Form>
          </Segment>

          {/* Generation Result */}
          {showResult && generatedLesson && (
            <Segment className="generation-result">
              <Header as="h2" color="green">
                <Icon name="checkmark circle" />
                Lesson Plan Generated Successfully!
              </Header>
              
              <Message positive>
                <Message.Header>{generatedLesson.title}</Message.Header>
                <p>Duration: {generatedLesson.duration} minutes | 
                   Complexity Score: {generatedLesson.complexity_score}/10 |
                   Model: {generatedLesson.ai_model}</p>
              </Message>

              <Button.Group>
                <Button 
                  as="a" 
                  href={generatedLesson.lesson_plan_url}
                  primary
                  icon="eye"
                  content="View Lesson Plan"
                />
                <Button 
                  as="a" 
                  href={`${generatedLesson.lesson_plan_url}/edit`}
                  secondary
                  icon="edit"
                  content="Edit & Customize"
                />
                <Button 
                  onClick={() => duplicateLesson(generatedLesson.lesson_plan_id)}
                  icon="copy"
                  content="Duplicate"
                />
              </Button.Group>
            </Segment>
          )}
        </Grid.Column>

        <Grid.Column width={6}>
          {/* Recent Lessons */}
          <Segment className="recent-lessons">
            <Header as="h3">
              <Icon name="history" />
              Recent Lesson Plans
            </Header>

            {recentLessons.length === 0 ? (
              <Message info>
                <Message.Header>No lesson plans yet</Message.Header>
                <p>Generate your first AI lesson plan to get started!</p>
              </Message>
            ) : (
              <div className="lesson-list">
                {recentLessons.slice(0, 5).map(lesson => (
                  <Segment key={lesson.id} className="lesson-item">
                    <div className="lesson-header">
                      <strong>{lesson.title}</strong>
                      {lesson.is_ai_generated && (
                        <Label size="tiny" color="blue">
                          <Icon name="magic" />
                          AI
                        </Label>
                      )}
                    </div>
                    <div className="lesson-meta">
                      <span>{lesson.subject} • Grade {lesson.grade_level}</span>
                      <span>{lesson.duration} min • {lesson.created}</span>
                    </div>
                    <div className="lesson-actions">
                      <Button.Group size="mini">
                        <Button 
                          as="a" 
                          href={lesson.url}
                          icon="eye"
                          content="View"
                        />
                        <Button 
                          onClick={() => duplicateLesson(lesson.id)}
                          icon="copy"
                          content="Copy"
                        />
                      </Button.Group>
                    </div>
                  </Segment>
                ))}
              </div>
            )}
          </Segment>

          {/* Generation Statistics */}
          {generationStats && (
            <Segment className="generation-stats">
              <Header as="h3">
                <Icon name="chart bar" />
                Generation Statistics
              </Header>
              
              <Statistic.Group size="mini" widths="two">
                <Statistic>
                  <Statistic.Value>{generationStats.total_generated}</Statistic.Value>
                  <Statistic.Label>Total Plans</Statistic.Label>
                </Statistic>
                <Statistic>
                  <Statistic.Value>
                    {Object.keys(generationStats.by_subject || {}).length}
                  </Statistic.Value>
                  <Statistic.Label>Subjects</Statistic.Label>
                </Statistic>
              </Statistic.Group>

              {generationStats.by_subject && Object.keys(generationStats.by_subject).length > 0 && (
                <div className="subject-breakdown">
                  <h4>By Subject:</h4>
                  {Object.entries(generationStats.by_subject).map(([subject, count]) => (
                    <div key={subject} className="stat-item">
                      <Label>
                        {subject}: {count}
                      </Label>
                    </div>
                  ))}
                </div>
              )}
            </Segment>
          )}
        </Grid.Column>
      </Grid>
    </Container>
  );
};

AILessonPlanner.propTypes = {
  contentUrl: PropTypes.string,
  onLessonGenerated: PropTypes.func,
};

export default AILessonPlanner;
```

#### **D1.2: Create CSS Styles**
**File**: `frontend/packages/volto-project-title/src/components/AI/AILessonPlanner.css` **(NEW FILE)**
```css
/* AI Lesson Planner Styles */

.ai-lesson-planner {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.ai-lesson-planner .ui.header {
  margin-bottom: 30px;
}

.ai-status {
  background: linear-gradient(45deg, #f8f9fa, #e9ecef);
  border: 1px solid #dee2e6;
  margin-bottom: 20px;
}

.ai-status .statistic {
  margin: 0 !important;
}

.generation-form {
  background: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.generation-form .ui.form .field > label {
  font-weight: 600;
  color: #2c3e50;
}

.topic-suggestions {
  margin-top: 10px;
}

.topic-suggestions .ui.label {
  transition: all 0.2s ease;
}

.topic-suggestions .ui.label:hover {
  background-color: #3498db !important;
  color: white !important;
  transform: translateY(-1px);
}

.generation-result {
  margin-top: 20px;
  border-left: 4px solid #27ae60;
}

.generation-result .ui.message {
  margin-bottom: 15px;
}

.recent-lessons {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
}

.lesson-list {
  max-height: 400px;
  overflow-y: auto;
}

.lesson-item {
  margin-bottom: 10px !important;
  padding: 15px !important;
  border-left: 3px solid #3498db;
  transition: all 0.2s ease;
}

.lesson-item:hover {
  border-left-color: #2980b9;
  transform: translateX(2px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.lesson-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.lesson-header strong {
  color: #2c3e50;
  font-size: 14px;
}

.lesson-meta {
  font-size: 12px;
  color: #7f8c8d;
  margin-bottom: 10px;
}

.lesson-meta span {
  margin-right: 10px;
}

.lesson-actions {
  text-align: right;
}

.generation-stats {
  background: #fff;
  border: 1px solid #e9ecef;
  margin-top: 20px;
}

.generation-stats .statistic {
  margin: 0 !important;
}

.subject-breakdown {
  margin-top: 15px;
}

.subject-breakdown h4 {
  margin-bottom: 10px;
  color: #2c3e50;
  font-size: 14px;
}

.stat-item {
  margin-bottom: 5px;
}

.stat-item .ui.label {
  font-size: 11px;
  margin-right: 5px;
}

/* Loading states */
.ui.form.loading {
  opacity: 0.7;
}

.ui.form.loading::before {
  background: rgba(255, 255, 255, 0.8);
}

/* Error states */
.ui.form .field.error input,
.ui.form .field.error .ui.dropdown {
  border-color: #e74c3c;
  background-color: #fdf2f2;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .ai-lesson-planner {
    padding: 10px;
  }
  
  .ai-lesson-planner .ui.grid > .column {
    padding-left: 0.5rem !important;
    padding-right: 0.5rem !important;
  }
  
  .lesson-item {
    padding: 10px !important;
  }
  
  .lesson-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .lesson-actions {
    text-align: left;
    margin-top: 10px;
  }
}

/* Animation for generation */
@keyframes generatePulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.ui.form.loading .ui.button.primary {
  animation: generatePulse 1.5s infinite;
}

/* Success animations */
.generation-result {
  animation: slideInUp 0.5s ease-out;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

#### **D1.3: Add Route Registration**
**File**: `frontend/packages/volto-project-title/src/index.js` **(ENHANCE EXISTING)**
```javascript
// ADD to existing imports
import AILessonPlanner from './components/AI/AILessonPlanner';

const applyConfig = (config) => {
  console.log('🚀 Edu Plone addon loading...');
  
  // ... existing configuration ...
  
  // Add AI Lesson Planner route
  config.addonRoutes = [
    {
      path: '/login',
      component: LoginComponent,
      exact: true,
    },
    {
      path: '/random-picker',
      component: RandomStudentPicker,
      exact: true,
    },
    {
      path: '/hall-pass-manager',
      component: HallPassManagerRoute,
      exact: true,
    },
    {
      path: '/timer',
      component: TimerPage,
      exact: true,
    },
    {
      path: '/substitute-folder',
      component: SubstitutePage,
      exact: true,
    },
    {
      path: '/dashboard',
      component: TeacherDashboard,
      exact: true,
    },
    {
      path: '/ai-lesson-planner',  // ADD
      component: AILessonPlanner,   // ADD
      exact: true,
    },
    ...(config.addonRoutes || []),
  ];
  
  // Register component for reuse
  if (!config.components) {
    config.components = {};
  }
  config.components.AILessonPlanner = AILessonPlanner;  // ADD
  
  console.log('✅ AI Lesson Planner component registered');
  
  return config;
};
```

---

## **PHASE E: Integration with Existing Features** 🔗 *2-3 hours*

### **E1: Dashboard Integration**

#### **E1.1: Add AI Lesson Plans to Dashboard**
**File**: `backend/src/project/title/browser/dashboard.py` **(ENHANCE EXISTING)**
```python
# ADD this method to existing TeacherDashboard class

def get_recent_lesson_plans(self):
    """Get recent AI-generated lesson plans for dashboard"""
    try:
        catalog = api.portal.get_tool('portal_catalog')
        
        # Get recent lesson plans
        lessons = catalog(
            portal_type='LessonPlan',
            sort_on='created',
            sort_order='descending',
            sort_limit=5,
            is_ai_generated=True  # Only AI-generated ones
        )
        
        lesson_data = []
        for brain in lessons:
            try:
                obj = brain.getObject()
                lesson_data.append({
                    'id': obj.getId(),
                    'title': obj.title,
                    'subject': getattr(obj, 'subject', 'Unknown'),
                    'grade_level': getattr(obj, 'grade_level', 'Unknown'),
                    'duration': getattr(obj, 'duration', 0),
                    'created': brain.created.strftime('%Y-%m-%d'),
                    'complexity_score': obj.get_complexity_score(),
                    'has_substitute_



                    # AI Lesson Plan Generator Implementation Checklist (Continued)

---

## **PHASE E: Integration with Existing Features** 🔗 *2-3 hours*

### **E1: Dashboard Integration**

#### **E1.1: Add AI Lesson Plans to Dashboard**
**File**: `backend/src/project/title/browser/dashboard.py` **(ENHANCE EXISTING)**
- [ ] Add `get_recent_lesson_plans()` method to `TeacherDashboard` class
- [ ] Query catalog for recent `LessonPlan` objects with `is_ai_generated=True`
- [ ] Return structured data including title, subject, grade, complexity score
- [ ] Handle errors gracefully with fallback empty list
- [ ] Include lesson plan URLs for quick access

#### **E1.2: Update Dashboard Data Aggregation**
**File**: `backend/src/project/title/browser/dashboard.py` **(ENHANCE EXISTING)**
- [ ] Modify `get_dashboard_data()` method to include lesson plan data
- [ ] Add `'lesson_plans': self.get_recent_lesson_plans()` to data dictionary
- [ ] Update `get_quick_stats()` to include lesson plan count
- [ ] Add lesson plan generation alerts (e.g., "No lesson plans for tomorrow")

#### **E1.3: Frontend Dashboard Widget**
**File**: `frontend/packages/volto-project-title/src/components/Dashboard/widgets/LessonPlanWidget.jsx` **(NEW FILE)**
- [ ] Create widget component showing recent AI lesson plans
- [ ] Display lesson titles, subjects, grades, complexity scores
- [ ] Add quick action buttons: "View", "Duplicate", "Generate New"
- [ ] Show generation statistics (total plans, time saved)
- [ ] Link to full AI lesson planner interface

#### **E1.4: Update Main Dashboard**
**File**: `frontend/packages/volto-project-title/src/components/Dashboard/TeacherDashboard.jsx` **(ENHANCE EXISTING)**
- [ ] Import and add `LessonPlanWidget` to dashboard grid
- [ ] Position widget in appropriate column (right side recommended)
- [ ] Ensure responsive layout on mobile devices
- [ ] Add loading states and error handling

### **E2: Substitute Folder Integration**

#### **E2.1: Include Lesson Plans in Substitute Folder**
**File**: `backend/src/project/title/browser/substitute_folder.py` **(ENHANCE EXISTING)**
- [ ] Modify `generate_folder()` method to include recent lesson plans
- [ ] Add new section: "Today's AI Lesson Plans"
- [ ] Copy relevant lesson plan content to substitute folder
- [ ] Generate simplified versions automatically if not present
- [ ] Include emergency contacts from lesson plans

#### **E2.2: Auto-Generate Substitute Versions**
**File**: `backend/src/project/title/browser/substitute_folder.py` **(ENHANCE EXISTING)**
- [ ] Add `get_lesson_plans_for_substitute()` method
- [ ] Filter lesson plans by date (today/tomorrow)
- [ ] Check if substitute versions exist, generate if missing
- [ ] Use AI service to create simplified versions on-the-fly
- [ ] Cache generated substitute content for performance

#### **E2.3: Lesson Plan Substitute Content**
**File**: `backend/src/project/title/browser/substitute_folder.py` **(ENHANCE EXISTING)**
- [ ] Create `generate_lesson_substitute_content()` method
- [ ] Extract key information: objectives, materials, activities
- [ ] Add timing estimates and step-by-step instructions
- [ ] Include behavior management tips
- [ ] Add "what if" scenarios (early finishers, technology issues)

### **E3: Navigation Integration**

#### **E3.1: Add to Main Navigation**
**File**: `frontend/packages/volto-project-title/src/components/Navigation/ClassroomNavigation.jsx` **(NEW OR ENHANCE EXISTING)**
- [ ] Create classroom management navigation component
- [ ] Add "AI Lesson Planner" link with icon
- [ ] Include in main site navigation or create dedicated menu
- [ ] Add keyboard shortcuts (Alt+L for Lesson Planner)
- [ ] Show notification badges for new features

#### **E3.2: Quick Access from Existing Features**
**Multiple Frontend Files** **(ENHANCE EXISTING)**
- [ ] Add "Generate Lesson Plan" button to seating chart creation
- [ ] Include lesson planner link in timer completion notifications
- [ ] Add to hall pass manager interface for related lessons
- [ ] Create floating action button for quick AI access
- [ ] Add context-sensitive suggestions

---

## **PHASE F: Dependencies & Environment Setup** 📦 *1-2 hours*

### **F1: Python Dependencies**

#### **F1.1: Update Requirements**
**File**: `backend/pyproject.toml` **(ENHANCE EXISTING)**
- [ ] Add `openai>=1.0.0` to dependencies
- [ ] Add `anthropic>=0.8.0` to dependencies  
- [ ] Add `python-dotenv>=1.0.0` for environment management
- [ ] Add `tiktoken>=0.5.0` for token counting
- [ ] Update optional dependencies for AI features

#### **F1.2: Environment Configuration**
**File**: `backend/.env.example` **(NEW FILE)**
- [ ] Create example environment file
- [ ] Document required variables: `OPENAI_API_KEY`, `ANTHROPIC_API_KEY`
- [ ] Add optional settings: `AI_MODEL_PREFERENCE`, `AI_CACHE_ENABLED`
- [ ] Include security warnings about API key handling
- [ ] Provide setup instructions for different deployment environments

#### **F1.3: Environment Validation**
**File**: `backend/src/project/title/setuphandlers/ai_setup.py` **(NEW FILE)**
- [ ] Create setup handler for AI service validation
- [ ] Check for required environment variables
- [ ] Test API connectivity during installation
- [ ] Register setup handler in `configure.zcml`
- [ ] Provide helpful error messages for missing configuration

### **F2: Frontend Dependencies**

#### **F2.1: Package Dependencies**
**File**: `frontend/packages/volto-project-title/package.json` **(ENHANCE EXISTING)**
- [ ] Add `react-syntax-highlighter` for code display
- [ ] Add `react-markdown` for rendering AI content
- [ ] Add `date-fns` for date formatting
- [ ] Add `lodash.debounce` for input optimization
- [ ] Update peer dependencies as needed

#### **F2.2: Build Configuration**
**File**: `frontend/packages/volto-project-title/webpack.config.js` **(NEW OR ENHANCE)**
- [ ] Configure polyfills for older browsers
- [ ] Add bundle splitting for AI components
- [ ] Optimize for performance (lazy loading)
- [ ] Configure environment variable handling
- [ ] Add development vs production optimizations

### **F3: Database Indexes for Performance**

#### **F3.1: AI-Specific Catalog Indexes**
**File**: `backend/src/project/title/catalog.py` **(ENHANCE EXISTING)**
- [ ] Add `is_ai_generated` boolean index
- [ ] Add `ai_model` field index for filtering
- [ ] Add `complexity_score` field index for sorting
- [ ] Add `lesson_date` date index for calendar queries
- [ ] Add `generation_date` index for recent content

#### **F3.2: Update Catalog Configuration**
**File**: `backend/src/project/title/profiles/default/catalog.xml` **(ENHANCE EXISTING)**
- [ ] Register new indexes in catalog configuration
- [ ] Add metadata columns for performance
- [ ] Configure index sorting and filtering options
- [ ] Set up reindex policies for new content
- [ ] Test index performance with sample data

---

## **PHASE G: Testing & Quality Assurance** ✅ *2-3 hours*

### **G1: Unit Tests**

#### **G1.1: AI Service Tests**
**File**: `backend/src/project/title/tests/test_ai_service.py` **(NEW FILE)**
- [ ] Test AI service initialization and configuration
- [ ] Mock API responses for consistent testing
- [ ] Test prompt generation for different subjects/grades
- [ ] Test response parsing and error handling
- [ ] Test rate limiting and caching behavior
- [ ] Test fallback scenarios when AI unavailable

#### **G1.2: Content Type Tests**
**File**: `backend/src/project/title/tests/test_lesson_plan.py` **(NEW FILE)**
- [ ] Test lesson plan creation and field validation
- [ ] Test vocabulary extraction and standards alignment
- [ ] Test complexity score calculation
- [ ] Test substitute version generation
- [ ] Test integration with existing content types
- [ ] Test permissions and security

#### **G1.3: Browser View Tests**
**File**: `backend/src/project/title/tests/test_ai_lesson_views.py` **(NEW FILE)**
- [ ] Test lesson plan generation endpoint
- [ ] Test form validation and error handling  
- [ ] Test AI service integration in views
- [ ] Test dashboard integration
- [ ] Test substitute folder integration
- [ ] Test CORS and API response formats

### **G2: Integration Tests**

#### **G2.1: Feature Integration Tests**
**File**: `backend/src/project/title/tests/test_ai_integration.py` **(NEW FILE)**
- [ ] Test lesson plan creation from dashboard
- [ ] Test substitute folder inclusion of lesson plans
- [ ] Test lesson plan duplication and modification
- [ ] Test statistics tracking and reporting
- [ ] Test error scenarios and graceful degradation
- [ ] Test performance with multiple concurrent requests

#### **G2.2: Frontend Component Tests**
**File**: `frontend/packages/volto-project-title/src/components/AI/AILessonPlanner.test.jsx` **(NEW FILE)**
- [ ] Test form validation and submission
- [ ] Test AI service status handling
- [ ] Test topic suggestions and auto-completion
- [ ] Test generation result display
- [ ] Test recent lessons integration
- [ ] Test responsive design and accessibility

### **G3: Performance Testing**

#### **G3.1: AI Response Time Testing**
**File**: `backend/src/project/title/tests/test_ai_performance.py` **(NEW FILE)**
- [ ] Benchmark lesson plan generation times
- [ ] Test caching effectiveness
- [ ] Test concurrent generation requests
- [ ] Measure database query performance
- [ ] Test memory usage during generation
- [ ] Validate timeout handling

#### **G3.2: Load Testing**
**Scripts in `backend/tests/performance/`** **(NEW DIRECTORY)**
- [ ] Create load testing scripts for AI endpoints
- [ ] Test dashboard performance with lesson plan data
- [ ] Test substitute folder generation under load
- [ ] Validate cache performance and invalidation
- [ ] Test database performance with large datasets
- [ ] Document performance benchmarks

---

## **PHASE H: Documentation & Deployment** 📖 *1-2 hours*

### **H1: User Documentation**

#### **H1.1: Teacher User Guide**
**File**: `_project-docs/user-guides/ai-lesson-planner-guide.md` **(NEW FILE)**
- [ ] Create step-by-step usage instructions
- [ ] Include screenshots of key interface elements
- [ ] Document best practices for prompt engineering
- [ ] Explain AI model differences and selection
- [ ] Provide troubleshooting guide
- [ ] Include examples of generated content

#### **H1.2: Administrator Setup Guide**
**File**: `_project-docs/admin/ai-service-setup.md` **(NEW FILE)**
- [ ] Document AI service configuration
- [ ] Provide API key setup instructions
- [ ] Explain security considerations
- [ ] Document monitoring and maintenance
- [ ] Include cost estimation guidelines
- [ ] Provide backup and recovery procedures

### **H2: Technical Documentation**

#### **H2.1: API Documentation**
**File**: `_project-docs/technical/ai-api-reference.md` **(NEW FILE)**
- [ ] Document all AI-related endpoints
- [ ] Provide request/response examples
- [ ] Document error codes and handling
- [ ] Include authentication requirements
- [ ] Provide SDK/integration examples
- [ ] Document rate limits and quotas

#### **H2.2: Architecture Documentation**
**File**: `_project-docs/technical/ai-architecture.md` **(NEW FILE)**
- [ ] Document AI service integration patterns
- [ ] Explain data flow and security
- [ ] Document caching and performance strategies
- [ ] Include deployment considerations
- [ ] Document monitoring and alerting
- [ ] Provide scaling recommendations

### **H3: Deployment Configuration**

#### **H3.1: Docker Environment**
**File**: `docker-compose.yml` **(ENHANCE EXISTING)**
- [ ] Add environment variables for AI services
- [ ] Configure secret management for API keys
- [ ] Add health checks for AI service connectivity
- [ ] Configure logging for AI operations
- [ ] Add backup strategies for generated content
- [ ] Document production deployment steps

#### **H3.2: Production Deployment**
**File**: `devops/stacks/project-title.example.com.yml` **(ENHANCE EXISTING)**
- [ ] Add AI service environment configuration
- [ ] Configure secure secret storage
- [ ] Add monitoring for AI service usage
- [ ] Configure rate limiting and quotas
- [ ] Add backup procedures for lesson plans
- [ ] Document scaling and maintenance procedures

---

## **PHASE I: Final Integration & Testing** 🚀 *1-2 hours*

### **I1: End-to-End Testing**

#### **I1.1: Complete User Workflow Testing**
- [ ] Test full lesson plan generation workflow
- [ ] Verify dashboard integration works correctly
- [ ] Test substitute folder inclusion
- [ ] Validate all error scenarios
- [ ] Test on different devices and browsers
- [ ] Verify accessibility compliance

#### **I1.2: Performance Validation**
- [ ] Measure lesson plan generation times (target: <30 seconds)
- [ ] Validate dashboard loading performance
- [ ] Test concurrent user scenarios
- [ ] Measure database query performance
- [ ] Validate caching effectiveness
- [ ] Document performance benchmarks

### **I2: Security Review**

#### **I2.1: Security Validation**
- [ ] Validate API key security and rotation
- [ ] Test input sanitization and validation
- [ ] Verify user permission enforcement
- [ ] Test CORS and authentication
- [ ] Validate data privacy compliance
- [ ] Document security best practices

### **I3: Production Readiness**

#### **I3.1: Deployment Checklist**
- [ ] All environment variables documented
- [ ] Database migrations tested
- [ ] Monitoring and alerting configured
- [ ] Backup procedures tested
- [ ] Performance benchmarks documented
- [ ] User training materials ready

#### **I3.2: Launch Preparation**
- [ ] Create launch announcement
- [ ] Prepare user onboarding materials
- [ ] Set up support documentation
- [ ] Configure usage analytics
- [ ] Plan gradual rollout strategy
- [ ] Prepare rollback procedures

---

## **SUCCESS CRITERIA** ✅

### **Technical Excellence**
- [ ] AI lesson plan generation works reliably
- [ ] Performance targets met (<30s generation, <2s dashboard)
- [ ] Zero breaking changes to existing features
- [ ] Comprehensive error handling and fallbacks
- [ ] Security best practices implemented

### **User Experience**
- [ ] Intuitive interface for teachers
- [ ] Clear value proposition (3-5 hours saved weekly)
- [ ] Seamless integration with existing classroom tools
- [ ] Mobile-friendly responsive design
- [ ] Accessibility compliance (WCAG 2.1 AA)

### **Business Value**
- [ ] Demonstrates clear AI innovation
- [ ] Quantifiable teacher productivity improvement
- [ ] Professional-grade educational content generation
- [ ] Scalable architecture for future AI features
- [ ] Comprehensive documentation for maintenance

### **Project Brief Alignment**
- [ ] Adds exactly 1 new meaningful feature (AI Lesson Planner)
- [ ] Shows innovative AI utilization
- [ ] Integrates with existing Plone architecture
- [ ] Demonstrates educational domain expertise
- [ ] Provides measurable business value

**Estimated Total Implementation Time: 18-24 hours (3-4 days)**

This comprehensive AI Lesson Plan Generator will demonstrate advanced AI integration while providing genuine value to teachers, completing your classroom management platform with cutting-edge educational technology.